var _hmt=_hmt||[],HKI=HKI||{};!function(){"use strict";HKI.modal={init:function e(n,t,i){var r=this;t.addEventListener("click",function(){var e=this.classList;e.contains("is-active")?r.close(n,t):r.open(n,t)}),(i=i||function(){})()},open:function e(n,t){n.classList.add("is-active"),t.classList.add("is-active"),document.getElementsByTagName("html")[0].classList.add("is-modal")},close:function e(n,t){n.classList.remove("is-active"),t.classList.remove("is-active"),document.getElementsByTagName("html")[0].classList.remove("is-modal")}}}(),function(){"use strict";for(var e=document,n=["iPhone","iPad","MQQBrowser","Android"],t=navigator.userAgent,i=e.getElementsByTagName("html")[0],r=0;r<n.length;r++){var a=new RegExp(n[r]);t.match(a)&&i.classList.add("ua-"+n[r])}}(),function(){"use strict";var e=document;e.getElementsByTagName("body")[0].addEventListener("touchstart",function(){}),e.getElementsByTagName("html")[0].setAttribute("lang","en"),setTimeout(function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?eaf8f8142362f214010695018ea0ce05";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)},0)}(),function(){"use strict";var e={PAGE_MARGIN:112,SCROLL_THRES:60,SCROLL_DURATION:400,curPage:0,totalPage:0,isMoving:!1,vw:0,vh:0,init:function e(n){var t=document;t.querySelector("html").classList.add("book-html"),t.querySelector("body").classList.add("book-body"),this.vw=Math.max(t.documentElement.clientWidth,window.innerWidth||0),this.vh=Math.max(t.documentElement.clientHeight,window.innerHeight||0),this.paginate(n),this.scroll(n),this.listenWindowResize(n)},listenWindowResize:function e(n){var t=document,i=this;window.addEventListener("resize",function(){n.setAttribute("style",""),i.curPage=0,i.totalPage=0,i.isMoving=!1,i.vw=Math.max(t.documentElement.clientWidth,window.innerWidth||0),i.vh=Math.max(t.documentElement.clientHeight,window.innerHeight||0),i.paginate(n)})},paginate:function e(n){var t=n.clientHeight;this.totalPage=Math.ceil(t/(this.vh-this.PAGE_MARGIN)),n.style.width=100*this.totalPage+"%",n.style.columnCount=this.totalPage,n.style.webkitColumnCount=this.totalPage},scroll:function e(n){var t=this,i=-1,r=-1,a=0;t.isMoving=!1,n.addEventListener("touchstart",function(e){n.style.transition="",r=i=e.touches[0].clientX,t.isMoving=!0}),n.addEventListener("mousedown",function(e){n.style.transition="",r=i=e.clientX,t.isMoving=!0}),n.addEventListener("touchmove",function(e){e.preventDefault(),t.isMoving&&(r=e.touches[0].clientX,a=r-i,requestAnimationFrame(t.updateScroll.bind(t,n,a)))}),n.addEventListener("mousemove",function(e){e.preventDefault(),t.isMoving&&(r=e.clientX,a=r-i,requestAnimationFrame(t.updateScroll.bind(t,n,a)))}),n.addEventListener("touchend",function(){t.isMoving&&requestAnimationFrame(t.endScroll.bind(t,n,a))}),n.addEventListener("touchcancel",function(){t.isMoving&&requestAnimationFrame(t.endScroll.bind(t,n,a))}),n.addEventListener("mouseup",function(){t.isMoving&&requestAnimationFrame(t.endScroll.bind(t,n,a))}),n.addEventListener("mouseleave",function(){t.isMoving&&requestAnimationFrame(t.endScroll.bind(t,n,a))})},updateScroll:function e(n,t){n.style.transform="translate3d("+(t-this.vw*this.curPage)+"px,0,0)"},endScroll:function e(n,t){n.style.transition="transform "+this.SCROLL_DURATION+"ms ease-in-out",Math.abs(t)>=this.SCROLL_THRES?t<0&&this.curPage<this.totalPage-1?(this.curPage++,n.style.transform="translate3d("+-this.vw*this.curPage+"px,0,0)"):t>0&&this.curPage>0?(this.curPage--,n.style.transform="translate3d("+-this.vw*this.curPage+"px,0,0)"):n.style.transform="translate3d("+-this.vw*this.curPage+"px,0,0)":n.style.transform="translate3d("+-this.vw*this.curPage+"px,0,0)",this.isMoving=!1}},n=document.querySelector(".book");n&&e.init(n)}(),function(){"use strict";var e=document,n=e.querySelector(".toc"),t=e.querySelector(".js-toc-btn"),i=function e(){n.addEventListener("click",function(e){(e.target.classList.contains("toc")||e.target.hasAttribute("href"))&&HKI.modal.close(n,t)})},r={PADDING:128,$target:{},init:function e(){this.getTarget(),this.markTarget(),this.scrollOffset(),this.listenWindowResize()},listenWindowResize:function e(){var n=this;window.addEventListener("resize",function(){n.scrollOffset()})},getTarget:function e(){var n=document,t="toc-"+n.getElementsByTagName("body")[0].getAttribute("data-toc");this.$target=n.getElementById(t)},markTarget:function e(){this.$target.classList.add("is-active"),this.$target.setAttribute("href","#")},scrollOffset:function e(){var n=this.$target.offsetTop,t=document.querySelector(".toc-wrap");t.scrollTop=n-this.PADDING}};n&&(HKI.modal.init(n,t,i),r.init())}();var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};/**
 * @license
 * 漢字標準格式 v3.2.5 | MIT License | css.hanzi.co
 */
void function(e,n){"object"===("undefined"==typeof module?"undefined":_typeof(module))&&"object"===_typeof(module.exports)?module.exports=n(e,!0):"function"==typeof define&&define.amd?define(function(){return n(e,!0)}):n(e)}("undefined"!=typeof window?window:this,function(e,n){"use strict";function t(e,n){var t=$.create("h-char-group","biaodian cjk");return 0===e.index&&e.isEnd?t.innerHTML=n[0]:(t.innerHTML=e.text,t.classList.add("portion"),0===e.index?t.classList.add("isFirst"):e.isEnd&&t.classList.add("isEnd")),t}function i(e){var n=$.create("div"),t=e.charCodeAt(0).toString(16),i="biaodian cjk "+(e.match(y.char.biaodian.open)?"open":e.match(y.char.biaodian.close)?"close end":e.match(y.char.biaodian.end)?"end":e.match(new RegExp("("+v.biaodian.liga+")"))?"liga":"");return n.innerHTML='<h-char unicode="'+t+'" class="'+i+'">'+e+"</h-char>",n.firstChild}function r(e,n){var t=$.create("canvas"),i;return t.width="50",t.height="20",t.style.display="none",h.appendChild(t),i=t.getContext("2d"),i.textBaseline="top",i.font="15px "+n+", sans-serif",i.fillStyle="black",i.strokeStyle="black",i.fillText(e,0,0),{node:t,context:i,remove:function e(){$.remove(t,h)}}}function a(e,n){var t,i=e.context,r=n.context;try{for(var a=1;a<=20;a++)for(var o=1;o<=50;o++){if("undefined"==typeof t&&i.getImageData(o,a,1,1).data[3]!==r.getImageData(o,a,1,1).data[3]){t=!1;break}if("boolean"==typeof t)break;50===o&&20===a&&"undefined"==typeof t&&(t=!0)}return e.remove(),n.remove(),e=null,n=null,t}catch(e){}return!1}function o(e,n,t){var e=e,n=n||"sans-serif",t=t||"辭Q",i;return n=r(t,n),e=r(t,e),!a(e,n)}function c(e,n,t){var i=$.create("h-ru"),n=$.clone(n),t=t||{};return t.annotation="true",Array.isArray(e)?i.innerHTML=e.map(function(e){return"undefined"==typeof e?"":e.outerHTML}).join("")+n.outerHTML:(i.appendChild($.clone(e)),i.appendChild(n)),$.setAttr(i,t),i}function s(e,n){var e=$.clone(e),t=$.create("h-ru"),i=n.textContent,r,a,o;return r=i.replace(y.zhuyin.diao,""),o=r?r.length:0,a=i.replace(r,"").replace(/[\u02C5]/g,"ˇ").replace(/[\u030D]/g,"͘"),t.appendChild(e),t.innerHTML+="<h-zhuyin><h-yin>"+r+"</h-yin><h-diao>"+a+"</h-diao></h-zhuyin>",$.setAttr(t,{zhuyin:"true",diao:a,length:o}),t}function d(){var e=$.create("div"),n;return e.innerHTML="<span>a b</span><span style=\"font-family: 'Han Space'\">a b</span>",h.appendChild(e),n=e.firstChild.offsetWidth!==e.lastChild.offsetWidth,$.remove(e,h),n}var l=e.document,u=l.documentElement,h=l.body,f="3.2.5",p=["initCond","renderElem","renderHanging","renderJiya","renderHWS","correctBasicBD","substCombLigaWithPUA"],g=function e(n,t){return new e.fn.init(n,t)},m=function e(){return arguments[0]&&(this.context=arguments[0]),arguments[1]&&(this.condition=arguments[1]),this};g.version=f,g.fn=g.prototype={version:f,constructor:g,context:h,condition:u,routine:p,init:m,setRoutine:function e(n){return Array.isArray(n)&&(this.routine=n),this},render:function e(n){var t=this,n=Array.isArray(n)?n:this.routine;return n.forEach(function(e){try{"string"==typeof e?t[e]():Array.isArray(e)&&t[e.shift()].apply(t,e)}catch(e){}}),this}},g.fn.init.prototype=g.fn,g.init=function(){return g.init=g().render()};var v={punct:{base:"[…,.;:!?‽_]",sing:"[‐-—…]",middle:"[\\/~\\-&‐-—_]",open:"['\"\\(\\[¡¿⸘«‹‚“„]",close:"['\"\\)\\]»›‛”‟]",end:"['\"\\)\\]»›‛”‟‼‽⁇-⁉,.;:!?]"},biaodian:{base:"[︰．、，。：；？！ー]",liga:"[—…⋯]",middle:"[·＼／－゠＆・＿]",open:"[「『《〈（〔［｛【〖]",close:"[」』》〉）〕］｝】〗]",end:"[」』》〉）〕］｝】〗︰．、，。：；？！ー]"},hanzi:{base:"[一-鿿㐀-䶵㇀-㇣〇﨎﨏﨑﨓﨔﨟﨡﨣﨤﨧-﨩]|[�-�][�-�]",desc:"[⿰-⿺]",radical:"[⼀-⿕⺀-⻳]"},latin:{base:"[A-Za-z0-9%&+/À-ÿĀ-ſƀ-ɏⱠ-Ɀ꜠-ꟿḀ-ỿ]",combine:"[̀-́᷀-᷿]"},ellinika:{base:"[0-9Ͱ-Ͽἀ-῿]",combine:"[̀-᷀ͅ-᷿]"},kirillica:{base:"[0-9Ѐ-҂Ҋ-ӿԀ-ԯꙀ-ꙮ꙾-ꚗ]",combine:"[҃-҉ⷠ-ⷿ꙯-꙽ꚟ]"},kana:{base:"[アイウエオ-ヺあいうえお-ゔゟヿ]|�[�-�]",small:"[ぁぃぅぇぉァィゥェォっゃゅょゎゕゖッャュョヮヵヶㇰ-ㇿ]",combine:"[゙-゜]",half:"[ｦ-ﾟ]",mark:"[゠ゝゞ・-ヾ]"},eonmun:{base:"[가-힣]",letter:"[ᄀ-ᇿㅏ-ㅣㄱ-ㆎꥠ-ꥼힰ-ퟻ]",half:"[ﾡ-ￜ]"},zhuyin:{base:"[ㄅ-ㄭㆠ-ㆺ]",initial:"[ㄅ-ㄙㄪ-ㄬㆠ-ㆣ]",medial:"[ㄧ-ㄩ]",final:"[ㄚ-ㄩㄭㆤ-ㆳㆸ-ㆺ]",tone:"[˙ˊ˅ˇˋ˪˫]",checked:"[ㆴ-ㆷ][̍͘]?"}},y=function(){var e="[\\x20\\t\\r\\n\\f]",n=v.punct.open,t=v.punct.close,i=v.punct.end,r=v.punct.middle,a=v.punct.sing,o=n+"|"+i+"|"+r,c=v.biaodian.open,s=v.biaodian.close,d=v.biaodian.end,l=v.biaodian.middle,u=v.biaodian.liga+"{2}",h=c+"|"+d+"|"+l,f=v.kana.base+v.kana.combine+"?",p=v.kana.small+v.kana.combine+"?",g=v.kana.half,m=v.eonmun.base+"|"+v.eonmun.letter,y=v.eonmun.half,b=v.hanzi.base+"|"+v.hanzi.desc+"|"+v.hanzi.radical+"|"+f,x=v.ellinika.combine,E=v.latin.base+x+"*",w=v.ellinika.base+x+"*",N=v.kirillica.combine,S=v.kirillica.base+N+"*",T=E+"|"+w+"|"+S,C="['’]",L=b+"|(?:"+T+"|"+C+")+",k=v.zhuyin.initial,M=v.zhuyin.medial,I=v.zhuyin.final,R=v.zhuyin.tone+"|"+v.zhuyin.checked;return{char:{punct:{all:new RegExp("("+o+")","g"),open:new RegExp("("+n+")","g"),end:new RegExp("("+i+")","g"),sing:new RegExp("("+a+")","g")},biaodian:{all:new RegExp("("+h+")","g"),open:new RegExp("("+c+")","g"),close:new RegExp("("+s+")","g"),end:new RegExp("("+d+")","g"),liga:new RegExp("("+u+")","g")},hanzi:new RegExp("("+b+")","g"),latin:new RegExp("("+E+")","ig"),ellinika:new RegExp("("+w+")","ig"),kirillica:new RegExp("("+S+")","ig"),kana:new RegExp("("+f+"|"+p+"|"+g+")","g"),eonmun:new RegExp("("+m+"|"+y+")","g")},group:{biaodian:[new RegExp("(("+h+"){2,})","g"),new RegExp("("+u+c+")","g")],punct:null,hanzi:new RegExp("("+b+")+","g"),western:new RegExp("("+E+"|"+w+"|"+S+"|"+o+")+","ig"),kana:new RegExp("("+f+"|"+p+"|"+g+")+","g"),eonmun:new RegExp("("+m+"|"+y+"|"+o+")+","g")},jinze:{hanging:new RegExp("("+e+"*)("+s+"*|[…⋯]*)([、，。．])(?!"+d+")","ig"),touwei:new RegExp("("+c+"+)("+L+")("+d+"+)","ig"),tou:new RegExp("("+c+"+)("+L+")","ig"),wei:new RegExp("("+L+")("+d+"+)","ig"),middle:new RegExp("("+L+")("+l+")("+L+")","ig")},zhuyin:{form:new RegExp("^˙?("+k+")?("+M+")?("+I+")?("+R+")?$"),diao:new RegExp("("+R+")","g")},hws:{base:[new RegExp("("+b+")("+T+"|"+n+")","ig"),new RegExp("("+T+"|"+i+")("+b+")","ig")],strict:[new RegExp("("+b+")"+e+"?("+T+"|"+n+")","ig"),new RegExp("("+T+"|"+i+")"+e+"?("+b+")","ig")]},"display-as":{"ja-font-for-hant":["查 査","啟 啓","鄉 鄕","值 値","污 汚"],"comb-liga-pua":[["a[̍͘]","󰁡"],["e[̍͘]","󰁥"],["i[̍͘]","󰁩"],["o[̍͘]","󰁯"],["u[̍͘]","󰁵"],["ㆴ[̍͘]","󳆴"],["ㆵ[̍͘]","󳆵"],["ㆶ[̍͘]","󳆶"],["ㆷ[̍͘]","󳆷"]]},"inaccurate-char":[["[•‧]","·"],["⋯⋯","……"],["──","——"],["‵","‘"],["′","’"],["‶","“"],["″","”"]]}}();g.UNICODE=v,g.TYPESET=y,g.UNICODE.cjk=g.UNICODE.hanzi,g.UNICODE.greek=g.UNICODE.ellinika,g.UNICODE.cyrillic=g.UNICODE.kirillica,g.UNICODE.hangul=g.UNICODE.eonmun,g.UNICODE.zhuyin.ruyun=g.UNICODE.zhuyin.checked,g.TYPESET.char.cjk=g.TYPESET.char.hanzi,g.TYPESET.char.greek=g.TYPESET.char.ellinika,g.TYPESET.char.cyrillic=g.TYPESET.char.kirillica,g.TYPESET.char.hangul=g.TYPESET.char.eonmun;var $={id:function e(n,t){return(t||l).getElementById(n)},tag:function e(n,t){return this.makeArray((t||l).getElementsByTagName(n))},qsa:function e(n,t){return this.makeArray((t||l).querySelectorAll(n))},create:function e(n,t){var n="!"===n?l.createDocumentFragment():""===n?l.createTextNode(t||""):l.createElement(n);try{t&&(n.className=t)}catch(e){}return n},clone:function e(n,t){return n.cloneNode(t||!0)},remove:function e(n,t){return(t||n.parentNode).removeChild(n)},setAttr:function e(n,t){if("object"===("undefined"==typeof t?"undefined":_typeof(t))){var i=t.length;if("object"===_typeof(t[0])&&"name"in t[0])for(var r=0;r<i;r++)void 0!==t[r].value&&n.setAttribute(t[r].name,t[r].value);else for(var a in t)t.hasOwnProperty(a)&&void 0!==t[a]&&n.setAttribute(a,t[a]);return n}},isIgnorable:function e(n){return"WBR"===n.nodeName||n.nodeType===Node.COMMENT_NODE},makeArray:function e(n){return Array.prototype.slice.call(n)},extend:function e(n,t){var i="object"===("undefined"==typeof n?"undefined":_typeof(n))||"function"==typeof n||"object"===("undefined"==typeof t?"undefined":_typeof(t));if(i){for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}}},b=function(n){function t(e,n,t){var i=Element.prototype,r=i.matches||i.mozMatchesSelector||i.msMatchesSelector||i.webkitMatchesSelector;return e instanceof Element?r.call(e,n):!(!t||!/^[39]$/.test(e.nodeType))}var i="0.2.1",r=n.NON_INLINE_PROSE,a=n.PRESETS.prose.filterElements,o=e||{},c=o.document||void 0;if("undefined"==typeof c)throw new Error("Fibre requires a DOM-supported environment.");var s=function e(n,t){return new e.fn.init(n,t)};return s.version=i,s.matches=t,s.fn=s.prototype={constructor:s,version:i,finder:[],context:void 0,portionMode:"retain",selector:{},preset:"prose",init:function e(n,t){if(t&&(this.preset=null),this.selector={context:null,filter:[],avoid:[],boundary:[]},!n)throw new Error("A context is required for Fibre to initialise.");return n instanceof Node?n instanceof Document?this.context=n.body||n:this.context=n:"string"==typeof n&&(this.context=c.querySelector(n),this.selector.context=n),this},filterFn:function e(n){var i=this.selector.filter.join(", ")||"*",r=this.selector.avoid.join(", ")||null,o=t(n,i,!0)&&!t(n,r);return"prose"===this.preset?a(n)&&o:o},boundaryFn:function e(n){var i=this.selector.boundary.join(", ")||null,a=t(n,i);return"prose"===this.preset?r(n)||a:a},filter:function e(n){return"string"==typeof n&&this.selector.filter.push(n),this},endFilter:function e(n){return n?this.selector.filter=[]:this.selector.filter.pop(),this},avoid:function e(n){return"string"==typeof n&&this.selector.avoid.push(n),this},endAvoid:function e(n){return n?this.selector.avoid=[]:this.selector.avoid.pop(),this},addBoundary:function e(n){return"string"==typeof n&&this.selector.boundary.push(n),this},removeBoundary:function e(){return this.selector.boundary=[],this},setMode:function e(n){return this.portionMode="first"===n?"first":"retain",this},replace:function e(t,i){var r=this;return r.finder.push(n(r.context,{find:t,replace:i,filterElements:function e(n){return r.filterFn(n)},forceContext:function e(n){return r.boundaryFn(n)},portionMode:r.portionMode})),r},wrap:function e(t,i){var r=this;return r.finder.push(n(r.context,{find:t,wrap:i,filterElements:function e(n){return r.filterFn(n)},forceContext:function e(n){return r.boundaryFn(n)},portionMode:r.portionMode})),r},revert:function e(n){var t=this.finder.length,n=Number(n)||(0===n?Number(0):"all"===n?t:1);if("undefined"==typeof t||0===t)return this;n>t&&(n=t);for(var i=n;i>0;i--)this.finder.pop().revert();return this}},s.fn.filterOut=s.fn.avoid,s.fn.init.prototype=s.fn,s}(function(){function e(e){return"[object Array]"==d.call(e)}function n(e){return String(e).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function t(){return i.apply(null,arguments)||r.apply(null,arguments)}function i(e,n,i,a,o){if(n&&!n.nodeType&&arguments.length<=2)return!1;var c="function"==typeof i;c&&(i=function(e){return function(n,t){return e(n.text,t.startIndex)}}(i));var s=r(n,{find:e,wrap:c?null:i,replace:c?i:"$"+(a||"&"),prepMatch:function e(n,t){if(!n[0])throw"findAndReplaceDOMText cannot handle zero-length matches";if(a>0){var i=n[a];n.index+=n[0].indexOf(i),n[0]=i}return n.endIndex=n.index+n[0].length,n.startIndex=n.index,n.index=t,n},filterElements:o});return t.revert=function(){return s.revert()},!0}function r(e,n){return new a(e,n)}function a(e,n){var i=n.preset&&t.PRESETS[n.preset];if(n.portionMode=n.portionMode||o,i)for(var r in i)u.call(i,r)&&!u.call(n,r)&&(n[r]=i[r]);this.node=e,this.options=n,this.prepMatch=n.prepMatch||this.prepMatch,this.reverts=[],this.matches=this.search(),this.matches.length&&this.processMatches()}var o="retain",c="first",s=l,d={}.toString,u={}.hasOwnProperty;return t.NON_PROSE_ELEMENTS={br:1,hr:1,script:1,style:1,img:1,video:1,audio:1,canvas:1,svg:1,map:1,object:1,input:1,textarea:1,select:1,option:1,optgroup:1,button:1},t.NON_CONTIGUOUS_PROSE_ELEMENTS={address:1,article:1,aside:1,blockquote:1,dd:1,div:1,dl:1,fieldset:1,figcaption:1,figure:1,footer:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,header:1,hgroup:1,hr:1,main:1,nav:1,noscript:1,ol:1,output:1,p:1,pre:1,section:1,ul:1,br:1,li:1,summary:1,dt:1,details:1,rp:1,rt:1,rtc:1,script:1,style:1,img:1,video:1,audio:1,canvas:1,svg:1,map:1,object:1,input:1,textarea:1,select:1,option:1,optgroup:1,button:1,table:1,tbody:1,thead:1,th:1,tr:1,td:1,caption:1,col:1,tfoot:1,colgroup:1},t.NON_INLINE_PROSE=function(e){return u.call(t.NON_CONTIGUOUS_PROSE_ELEMENTS,e.nodeName.toLowerCase())},t.PRESETS={prose:{forceContext:t.NON_INLINE_PROSE,filterElements:function e(n){return!u.call(t.NON_PROSE_ELEMENTS,n.nodeName.toLowerCase())}}},t.Finder=a,a.prototype={search:function e(){function t(e){for(var n=0,c=e.length;n<c;++n){var l=e[n];if("string"==typeof l){if(o.global)for(;i=o.exec(l);)s.push(d.prepMatch(i,r++,a));else(i=l.match(o))&&s.push(d.prepMatch(i,0,a));a+=l.length}else t(l)}}var i,r=0,a=0,o=this.options.find,c=this.getAggregateText(),s=[],d=this;return o="string"==typeof o?RegExp(n(o),"g"):o,t(c),s},prepMatch:function e(n,t,i){if(!n[0])throw new Error("findAndReplaceDOMText cannot handle zero-length matches");return n.endIndex=i+n.index+n[0].length,n.startIndex=i+n.index,n.index=t,n},getAggregateText:function e(){function n(e,r){if(3===e.nodeType)return[e.data];if(t&&!t(e))return[];var r=[""],a=0;if(e=e.firstChild)do if(3!==e.nodeType){var o=n(e);i&&1===e.nodeType&&(i===!0||i(e))?(r[++a]=o,r[++a]=""):("string"==typeof o[0]&&(r[a]+=o.shift()),o.length&&(r[++a]=o,r[++a]=""))}else r[a]+=e.data;while(e=e.nextSibling);return r}var t=this.options.filterElements,i=this.options.forceContext;return n(this.node)},processMatches:function e(){var n=this.matches,t=this.node,i=this.options.filterElements,r,a,o=[],c=t,s=n.shift(),d=0,l=0,u=0,h,f=[t];e:for(;;){if(3===c.nodeType&&(!a&&c.length+d>=s.endIndex?a={node:c,index:u++,text:c.data.substring(s.startIndex-d,s.endIndex-d),indexInMatch:d-s.startIndex,indexInNode:s.startIndex-d,endIndexInNode:s.endIndex-d,isEnd:!0}:r&&o.push({node:c,index:u++,text:c.data,indexInMatch:d-s.startIndex,indexInNode:0}),!r&&c.length+d>s.startIndex&&(r={node:c,index:u++,indexInMatch:0,indexInNode:s.startIndex-d,endIndexInNode:s.endIndex-d,text:c.data.substring(s.startIndex-d,s.endIndex-d)}),d+=c.data.length),h=1===c.nodeType&&i&&!i(c),r&&a){if(c=this.replaceMatch(s,r,o,a),d-=a.node.data.length-a.endIndexInNode,r=null,a=null,o=[],s=n.shift(),u=0,l++,!s)break}else if(!h&&(c.firstChild||c.nextSibling)){c.firstChild?(f.push(c),c=c.firstChild):c=c.nextSibling;continue}for(;;){if(c.nextSibling){c=c.nextSibling;break}if(c=f.pop(),c===t)break e}}},revert:function e(){for(var n=this.reverts.length;n--;)this.reverts[n]();this.reverts=[]},prepareReplacementString:function e(n,t,i,r){var a=this.options.portionMode;return a===c&&t.indexInMatch>0?"":(n=n.replace(/\$(\d+|&|`|')/g,function(e,n){var t;switch(n){case"&":t=i[0];break;case"`":t=i.input.substring(0,i.startIndex);break;case"'":t=i.input.substring(i.endIndex);break;default:t=i[+n]}return t}),a===c?n:t.isEnd?n.substring(t.indexInMatch):n.substring(t.indexInMatch,t.indexInMatch+t.text.length))},getPortionReplacementNode:function e(n,t,i){var r=this.options.replace||"$&",a=this.options.wrap;if(a&&a.nodeType){var o=s.createElement("div");o.innerHTML=a.outerHTML||(new XMLSerializer).serializeToString(a),a=o.firstChild}if("function"==typeof r)return r=r(n,t,i),r&&r.nodeType?r:s.createTextNode(String(r));var c="string"==typeof a?s.createElement(a):a;return r=s.createTextNode(this.prepareReplacementString(r,n,t,i)),r.data&&c?(c.appendChild(r),c):r},replaceMatch:function e(n,t,i,r){var a=t.node,o=r.node,c,d;if(a===o){var l=a;t.indexInNode>0&&(c=s.createTextNode(l.data.substring(0,t.indexInNode)),l.parentNode.insertBefore(c,l));var u=this.getPortionReplacementNode(r,n);return l.parentNode.insertBefore(u,l),r.endIndexInNode<l.length&&(d=s.createTextNode(l.data.substring(r.endIndexInNode)),l.parentNode.insertBefore(d,l)),l.parentNode.removeChild(l),this.reverts.push(function(){c===u.previousSibling&&c.parentNode.removeChild(c),d===u.nextSibling&&d.parentNode.removeChild(d),u.parentNode.replaceChild(l,u)}),u}c=s.createTextNode(a.data.substring(0,t.indexInNode)),d=s.createTextNode(o.data.substring(r.endIndexInNode));for(var h=this.getPortionReplacementNode(t,n),f=[],p=0,g=i.length;p<g;++p){var m=i[p],v=this.getPortionReplacementNode(m,n);m.node.parentNode.replaceChild(v,m.node),this.reverts.push(function(e,n){return function(){n.parentNode.replaceChild(e.node,n)}}(m,v)),f.push(v)}var y=this.getPortionReplacementNode(r,n);return a.parentNode.insertBefore(c,a),a.parentNode.insertBefore(h,a),a.parentNode.removeChild(a),o.parentNode.insertBefore(y,o),o.parentNode.insertBefore(d,o),o.parentNode.removeChild(o),this.reverts.push(function(){c.parentNode.removeChild(c),h.parentNode.replaceChild(a,h),d.parentNode.removeChild(d),y.parentNode.replaceChild(o,y)}),y}},t}());$.extend(b.fn,{jinzify:function e(n){return this.filter(n||null).avoid("h-jinze").replace(y.jinze.touwei,function(e,n){var t=$.create("h-jinze","touwei");return t.innerHTML=n[0],0===e.index&&e.isEnd||1===e.index?t:""}).replace(y.jinze.wei,function(e,n){var t=$.create("h-jinze","wei");return t.innerHTML=n[0],0===e.index?t:""}).replace(y.jinze.tou,function(e,n){var t=$.create("h-jinze","tou");return t.innerHTML=n[0],0===e.index&&e.isEnd||1===e.index?t:""}).replace(y.jinze.middle,function(e,n){var t=$.create("h-jinze","middle");return t.innerHTML=n[0],0===e.index&&e.isEnd||1===e.index?t:""}).endAvoid().endFilter()},groupify:function e(n){var n=$.extend({biaodian:!1,hanzi:!1,kana:!1,eonmun:!1,western:!1},n||{});return this.avoid("h-hangable, h-char-group, h-word"),n.biaodian&&this.replace(y.group.biaodian[0],t).replace(y.group.biaodian[1],t),(n.hanzi||n.cjk)&&this.wrap(y.group.hanzi,$.clone($.create("h-char-group","hanzi cjk"))),n.western&&this.wrap(y.group.western,$.clone($.create("h-word","western"))),n.kana&&this.wrap(y.group.kana,$.clone($.create("h-char-group","kana"))),(n.eonmun||n.hangul)&&this.wrap(y.group.eonmun,$.clone($.create("h-word","eonmun hangul"))),this.endAvoid(),this},charify:function e(n){var n=$.extend({biaodian:!1,punct:!1,hanzi:!1,latin:!1,ellinika:!1,kirillica:!1,kana:!1,eonmun:!1},n||{});return this.avoid("h-char"),n.biaodian&&this.replace(y.char.biaodian.all,function(e,n){return i(n[0])}).replace(y.char.biaodian.liga,function(e,n){return i(n[0])}),(n.hanzi||n.cjk)&&this.wrap(y.char.hanzi,$.clone($.create("h-char","hanzi cjk"))),n.punct&&this.wrap(y.char.punct.all,$.clone($.create("h-char","punct"))),n.latin&&this.wrap(y.char.latin,$.clone($.create("h-char","alphabet latin"))),(n.ellinika||n.greek)&&this.wrap(y.char.ellinika,$.clone($.create("h-char","alphabet ellinika greek"))),(n.kirillica||n.cyrillic)&&this.wrap(y.char.kirillica,$.clone($.create("h-char","alphabet kirillica cyrillic"))),n.kana&&this.wrap(y.char.kana,$.clone($.create("h-char","kana"))),(n.eonmun||n.hangul)&&this.wrap(y.char.eonmun,$.clone($.create("h-char","eonmun hangul"))),this.endAvoid(),this}}),g.find=b,void["setMode","wrap","replace","revert","addBoundary","removeBoundary","avoid","endAvoid","filter","endFilter","jinzify","groupify","charify"].forEach(function(e){g.fn[e]=function(){return this.finder||(this.finder=g.find(this.context)),this.finder[e](arguments[0],arguments[1]),this}});var x={};x.writeOnCanvas=r,x.compareCanvases=a,x.detectFont=o,x.support=function(){function n(e){var n=e.charAt(0).toUpperCase()+e.slice(1),t=(e+" "+r.join(n+" ")+n).split(" "),i;return t.forEach(function(e){"string"==typeof a.style[e]&&(i=!0)}),i||!1}function t(e,n){var t=h||$.create("body"),i=$.create("div"),r=h?i:t,n="function"==typeof n?n:function(){},a,o,c;return a=["<style>",e,"</style>"].join(""),r.innerHTML+=a,t.appendChild(i),h||(t.style.background="",t.style.overflow="hidden",c=u.style.overflow,u.style.overflow="hidden",u.appendChild(t)),o=n(r,e),$.remove(r),h||(u.style.overflow=c),!!o}function i(n,t){var i;return e.getComputedStyle?i=l.defaultView.getComputedStyle(n,null).getPropertyValue(t):n.currentStyle&&(i=n.currentStyle[t]),i}var r="Webkit Moz ms".split(" "),a=$.create("h-test"),o={};return{ruby:function(){var e=$.create("ruby"),n=$.create("rt"),t=$.create("rp"),r;return e.appendChild(t),e.appendChild(n),u.appendChild(e),r="none"===i(t,"display")||"ruby"===i(e,"display")&&"ruby-text"===i(n,"display"),u.removeChild(e),e=null,n=null,t=null,r}(),fontface:function(){var e;return t('@font-face { font-family: font; src: url("//"); }',function(n,t){var i=$.qsa("style",n)[0],r=i.sheet||i.styleSheet,a=r?r.cssRules&&r.cssRules[0]?r.cssRules[0].cssText:r.cssText||"":"";e=/src/i.test(a)&&0===a.indexOf(t.split(" ")[0])}),e}(),unicoderange:function(){var e;return t('@font-face{font-family:test-for-unicode-range;src:local(Arial),local("Droid Sans")}@font-face{font-family:test-for-unicode-range;src:local("Times New Roman"),local(Times),local("Droid Serif");unicode-range:U+270C}',function(){e=!x.detectFont("test-for-unicode-range",'Arial, "Droid Sans"',"Q")}),e}(),columnwidth:n("columnWidth"),textemphasis:n("textEmphasis"),writingmode:n("writingMode")}}(),x.initCond=function(e){var e=e||u,n="",t;for(var i in x.support)t=(x.support[i]?"":"no-")+i,e.classList.add(t),n+=t+" ";return n},$.extend(x,{renderElem:function e(n){this.renderRuby(n),this.renderDecoLine(n),this.renderDecoLine(n,"s, del"),this.renderEm(n)},renderDecoLine:function e(n,t){var t=t||"u, ins",i=$.qsa(t,n),r=new RegExp("^("+t.replace(/\,\s?/g,"|")+")$","ig");i.forEach(function(e){var n;do if(n=(n||e).nextSibling,!n)return;while($.isIgnorable(n));n.nodeName.match(r)&&n.classList.add("adjacent")})},renderEm:function e(n,t){var i=t?"qsa":"tag",t=t||"em",r=$[i](t,n);r.forEach(function(e){var n=g(e);x.support.textemphasis?n.avoid("rt, h-char, h-char-group").charify({biaodian:!0,punct:!0}):n.avoid("rt, h-char, h-char-group").jinzify().groupify({western:!0,biaodian:!0}).charify({hanzi:!0,biaodian:!0,punct:!0,latin:!0,ellinika:!0,kirillica:!0})})},renderRuby:function e(n,t){var i=t?"qsa":"tag",t=t||"ruby",r=$[i](t,n),a=$.qsa(t+", rtc",n);a.forEach(function(e){var n=e.classList;n.contains("pinyin")?n.add("romanization"):n.contains("mps")&&n.add("zhuyin"),n.contains("romanization")&&n.add("annotation")}),r.forEach(function(e){var n=e.classList,i=!x.support.ruby||n.contains("zhuyin")||n.contains("complex")||n.contains("rightangle"),r,a,o,d,l,u;i&&(r=$.create("!"),r.appendChild($.clone(e)),a=$.qsa(t,r)[0],x.support.ruby&&!n.contains("zhuyin")||$.tag("rt",a).forEach(function(e){var t=$.create("!"),i=[],r;do{if(r=(r||e).previousSibling,!r||r.nodeName.match(/((?:h\-)?r[ubt])/i))break;t.insertBefore($.clone(r),t.firstChild),i.push(r)}while(!r.nodeName.match(/((?:h\-)?r[ubt])/i));d=n.contains("zhuyin")?s(t,e):c(t,e);try{e.parentNode.replaceChild(d,e),i.forEach(function(e){$.remove(e)})}catch(e){}}),(n.contains("complex")||n.contains("rightangle"))&&(o=d=$.tag("rb",a),l=o.length,void function(n){n&&(d=$.tag("rt",n).map(function(e,n){if(o[n]){var t=s(o[n],e);try{o[n].parentNode.replaceChild(t,o[n])}catch(e){}return t}}),$.remove(n),e.setAttribute("rightangle","true"))}(a.querySelector("rtc.zhuyin")),$.qsa("rtc:not(.zhuyin)",a).forEach(function(t,i){var r;r=$.tag("rt",t).map(function(t,r){var a=Number(t.getAttribute("rbspan")||1),o=0,s=[],u,h;a>l&&(a=l);do{try{u=d.shift(),s.push(u)}catch(e){}if("undefined"==typeof u)break;o+=Number(u.getAttribute("span")||1)}while(a>o);if(a<o){if(s.length>1)return void console.error("An impossible `rbspan` value detected.",e);s=$.tag("rb",s[0]),d=s.slice(a).concat(d),s=s.slice(0,a),o=a}h=c(s,t,{class:n,span:o,order:i});try{s[0].parentNode.replaceChild(h,s.shift()),s.forEach(function(e){$.remove(e)})}catch(e){}return h}),d=r,1===i&&e.setAttribute("doubleline","true"),$.remove(t)})),u=$.create("h-ruby"),u.innerHTML=r.firstChild.innerHTML,$.setAttr(u,e.attributes),u.normalize(),e.parentNode.replaceChild(u,e))})}}),g.normalize=x,g.localize=x,g.support=x.support,g.detectFont=x.detectFont,g.fn.initCond=function(){return this.condition.classList.add("han-js-rendered"),g.normalize.initCond(this.condition),this},void["Elem","DecoLine","Em","Ruby"].forEach(function(e){var n="render"+e;g.fn[n]=function(e){return g.normalize[n](this.context,e),this}}),$.extend(g.support,{heiti:!0,songti:g.detectFont('"Han Songti"'),"songti-gb":g.detectFont('"Han Songti GB"'),kaiti:g.detectFont('"Han Kaiti"'),fangsong:g.detectFont('"Han Fangsong"')});var E="* > h-hws:first-child, * > wbr:first-child + h-hws, wbr:first-child + wbr + h-hws",w=function(){var e=$.create("div");return e.appendChild($.create("","0-")),e.appendChild($.create("","2")),e.normalize(),2!==e.firstChild.length}(),N=$.create("h-hws");N.setAttribute("hidden",""),N.innerHTML=" ",$.extend(g,{isNodeNormalizeNormal:w,renderHWS:function e(n,t){var n=n||l,i=t?"strict":"base",r=g.find(n);return t?r.avoid("textarea, code, kbd, samp, pre"):r.avoid("textarea"),r.replace(g.TYPESET.hws[i][0],"$1<hws/>$2").replace(g.TYPESET.hws[i][1],"$1<hws/>$2").replace(/(['"]+)<hws\/>(.+?)<hws\/>\1/gi,"$1$2$1").replace(/<hws\/>([‘“]+)/gi,"$1").replace(/([’”]+)<hws\/>/gi,"$1").replace("<hws/>",function(){return $.clone(N)}),$.qsa(E,n).forEach(function(e){for(var n=e.parentNode,t=n.firstChild;$.isIgnorable(t);)if(t=t.nextSibling,!t)return;for(;"H-HWS"===t.nodeName&&($.remove(t,n),t=n.parentNode.insertBefore($.clone(N),n),n=n.parentNode,w&&n.normalize(),t===n.firstChild););}),w&&n.normalize(),r}}),$.extend(g.fn,{HWS:null,renderHWS:function e(n){return g.renderHWS(this.context,n),this.HWS=$.tag("h-hws",this.context),this},revertHWS:function e(){return this.HWS.forEach(function(e){$.remove(e)}),this}}),$.extend(g,{detectSpaceFont:d,isSpaceFontLoaded:d()}),g.support["han-space"]=d(),g.renderHanging=function(e){var e=e||l,n=g.find(e);return n.avoid("textarea, code, kbd, samp, pre, h-hangable").replace(y.jinze.hanging,function(e,n){var t=$.create("h-hangable");return t.innerHTML=n[2]+'<h-cs><h-inner hidden> </h-inner><h-char class="biaodian close end cjk">'+n[3]+"</h-char></h-cs>",0===e.index?t:""}),n},$.extend(g.fn,{hanging:null,renderHanging:function e(){var n=this.condition.classList,t=d();return t&&n.contains("no-han-space")&&(n.remove("no-han-space"),n.add("han-space")),this.hanging=g.renderHanging(this.context),this},revertHanging:function e(){try{this.hanging.revert("all")}catch(e){}return this}}),g.renderJiya=function(e){var e=e||l,n=g.find(e);return n.avoid("textarea, code, kbd, samp, pre, h-char-group").replace(new RegExp("("+v.biaodian.end+"+)("+v.biaodian.open+"+)","g"),function(e,n){if(0===e.index)return e.isEnd?n[0]:n[1];var t=$.create("h-char-group","biaodian cjk portion");return t.innerHTML=n[2],t}).endAvoid(),n.avoid("textarea, code, kbd, samp, pre, h-char").groupify({biaodian:!0}).charify({biaodian:!0}),$.qsa("h-char.biaodian.open, h-char.biaodian.end",e).forEach(function(e){if(!g.find.matches(e,"h-cs *")){var n="<h-inner>"+e.innerHTML+"</h-inner>",t="<h-cs hidden> </h-cs>",i=e.classList.contains("open");e.innerHTML=i?t+n:n+t}}),n},$.extend(g.fn,{jiya:null,renderJiya:function e(){return this.jiya=g.renderJiya(this.context),this},revertJiya:function e(){try{this.jiya.revert("all")}catch(e){}return this}});var S;S=$.create("h-char","biaodian cjk middle"),S.setAttribute("unicode","b7"),g.correctBasicBD=function(e,n){if(!g.support.unicoderange||n){var e=e||l,t;t=g.find(e),t.wrap(/\u00B7/g,$.clone(S)).charify({biaodian:!0})}},$.extend(g.fn,{basicBD:null,correctBasicBD:function e(n){return this.basicBD=g.correctBasicBD(this.context,n),this},revertBasicBD:function e(){try{this.basicBD.revert("all")}catch(e){}return this}});var T="h-ru[annotation]",C="textarea, code, kbd, samp, pre",L=function(){var e=g.localize.writeOnCanvas("i̍",'"Romanization Sans"'),n=g.localize.writeOnCanvas("󰁩",'"Romanization Sans"');return g.localize.compareCanvases(e,n)}(),k=g.TYPESET["display-as"]["comb-liga-pua"],M=g.TYPESET["inaccurate-char"],I=$.create("h-char","comb-liga");return $.extend(g,{isCombLigaNormal:L,substCombLigaWithPUA:function e(n){if(!L){var n=n||l,t=g.find(n);return t.avoid(C),k.forEach(function(e){t.replace(new RegExp(e[0],"ig"),function(n,t){var i=$.clone(I);return i.innerHTML="<h-inner>"+t[0]+"</h-inner>",i.setAttribute("display-as",e[1]),0===n.index?i:""})}),$.qsa(T,n).forEach(function(e){var n=e.getAttribute("annotation");k.slice(0,5).forEach(function(e){n=n.replace(new RegExp(e[0],"ig"),e[1])}),e.setAttribute("annotation",n)}),t}},substInaccurateChar:function e(n){var n=n||l,t=g.find(n);t.avoid(C),M.forEach(function(e){t.replace(new RegExp(e[0],"ig"),e[1])})}}),$.extend(g.fn,{"comb-liga":null,"inaccurate-char":null,substCombLigaWithPUA:function e(){return this["comb-liga"]=g.substCombLigaWithPUA(this.context),this},revertCombLigaWithPUA:function e(){try{this["comb-liga"].revert("all")}catch(e){}return this},substInaccurateChar:function e(){return this["inaccurate-char"]=g.substInaccurateChar(this.context),this},revertInaccurateChar:function e(){try{this["inaccurate-char"].revert("all")}catch(e){}return this}}),e.addEventListener("DOMContentLoaded",function(){var e;u.classList.contains("han-init")?g.init():(e=l.querySelector(".han-init-context"))&&(g.init=g(e).render())}),"undefined"!=typeof n&&n!==!1||(e.Han=g),g}),function(){"use strict";var e=document,n=e.querySelector("html"),t=e.querySelector(".han-css");t&&!n.classList.contains("ua-Android")&&Han(t).initCond().renderJiya().renderHWS().substCombLigaWithPUA()}();
